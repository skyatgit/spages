# å‰åç«¯åˆ†ç¦»éƒ¨ç½²é…ç½®æŒ‡å—

## ğŸ“‹ é—®é¢˜è¯´æ˜

### å½“å‰æ¶æ„

**éƒ¨ç½²çš„é¡¹ç›®è¿è¡Œåœ¨åç«¯æœåŠ¡å™¨ä¸Š**ï¼Œå› ä¸ºï¼š
- åç«¯è´Ÿè´£ Git å…‹éš†ã€npm å®‰è£…ã€æ„å»ºç­‰æ“ä½œ
- åç«¯å¯åŠ¨é™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼ˆHTTP Serverï¼‰
- åç«¯ç®¡ç†æ‰€æœ‰è¿è¡Œä¸­çš„è¿›ç¨‹

### éƒ¨ç½²åœºæ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯æœåŠ¡å™¨                            â”‚
â”‚  IP: 192.168.1.10                                       â”‚
â”‚  æœåŠ¡: Vue å‰ç«¯ç•Œé¢                                      â”‚
â”‚  ç«¯å£: 5173                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ API è¯·æ±‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åç«¯æœåŠ¡å™¨                            â”‚
â”‚  IP: 192.168.1.20                                       â”‚
â”‚  æœåŠ¡: Express API + é¡¹ç›®éƒ¨ç½²                            â”‚
â”‚  ç«¯å£: 3000 (API), 3001-3050 (éƒ¨ç½²çš„é¡¹ç›®)               â”‚
â”‚                                                          â”‚
â”‚  è¿è¡Œä¸­çš„é¡¹ç›®:                                           â”‚
â”‚  - é¡¹ç›®A: http://192.168.1.20:3001                      â”‚
â”‚  - é¡¹ç›®B: http://192.168.1.20:3002                      â”‚
â”‚  - é¡¹ç›®C: http://192.168.1.20:3003                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš™ï¸ é…ç½®æ–¹æ³•

ç³»ç»Ÿç°åœ¨æ”¯æŒ 3 ç§æ–¹å¼é…ç½®æœåŠ¡å™¨è®¿é—®åœ°å€ï¼š

### æ–¹æ³• 1ï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

**ä¼˜å…ˆçº§æœ€é«˜**

```bash
# Linux/Mac
export SERVER_HOST=your-domain.com
# æˆ–
export SERVER_HOST=123.45.67.89

# Windows (PowerShell)
$env:SERVER_HOST="your-domain.com"

# Windows (CMD)
set SERVER_HOST=your-domain.com
```

**åœ¨ package.json ä¸­é…ç½®ï¼š**
```json
{
  "scripts": {
    "start": "SERVER_HOST=your-domain.com node server/index.js"
  }
}
```

**ä½¿ç”¨ .env æ–‡ä»¶ï¼ˆéœ€è¦ dotenv åŒ…ï¼‰ï¼š**
```env
SERVER_HOST=your-domain.com
PORT=3000
```

### æ–¹æ³• 2ï¼šé…ç½®æ–‡ä»¶ï¼ˆæ¨èå¼€å‘ç¯å¢ƒï¼‰

**ç¼–è¾‘ `data/config.json`ï¼š**

```json
{
  "admin": {
    "username": "admin",
    "password": "..."
  },
  "settings": {
    "dataDir": "SPages",
    "maxProjects": 50,
    "serverHost": "192.168.1.20",  // â† æ·»åŠ è¿™ä¸€è¡Œ
    "nodeVersions": [],
    "cleanupOldBuilds": true,
    "maxBuildAge": 30
  }
}
```

**æˆ–é€šè¿‡ç³»ç»Ÿè®¾ç½®é¡µé¢é…ç½®**ï¼ˆå¦‚æœæœ‰ï¼‰

### æ–¹æ³• 3ï¼šè‡ªåŠ¨æ£€æµ‹ï¼ˆé»˜è®¤ï¼‰

å¦‚æœæ²¡æœ‰é…ç½®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹ï¼š
1. æŸ¥æ‰¾éå†…éƒ¨çš„ IPv4 åœ°å€ï¼ˆå±€åŸŸç½‘ IPï¼‰
2. å¦‚æœæ‰¾ä¸åˆ°ï¼Œä½¿ç”¨ `localhost`

## ğŸŒ ä¸åŒåœºæ™¯çš„é…ç½®

### åœºæ™¯ 1ï¼šæœ¬æœºå¼€å‘

**é…ç½®ï¼š**
```json
{
  "settings": {
    "serverHost": "localhost"
  }
}
```

**æˆ–ä¸é…ç½®**ï¼ˆè‡ªåŠ¨æ£€æµ‹ä¼šè¿”å› localhostï¼‰

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯ï¼šhttp://localhost:5173
- åç«¯ï¼šhttp://localhost:3000
- é¡¹ç›®ï¼šhttp://localhost:3001, 3002, ...

### åœºæ™¯ 2ï¼šå±€åŸŸç½‘éƒ¨ç½²ï¼ˆå‰åç«¯åŒä¸€æœºå™¨ï¼‰

**é…ç½®ï¼š**
```json
{
  "settings": {
    "serverHost": "192.168.1.100"
  }
}
```

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯ï¼šhttp://192.168.1.100:5173
- åç«¯ï¼šhttp://192.168.1.100:3000
- é¡¹ç›®ï¼šhttp://192.168.1.100:3001, 3002, ...

**ä¼˜åŠ¿ï¼š**
- å±€åŸŸç½‘å…¶ä»–è®¾å¤‡å¯è®¿é—®
- æ‰‹æœºã€å¹³æ¿å¯æµ‹è¯•

### åœºæ™¯ 3ï¼šå‰åç«¯åˆ†ç¦»ï¼ˆä¸åŒæœºå™¨ï¼‰

**åç«¯æœºå™¨ IPï¼š** 192.168.1.20  
**å‰ç«¯æœºå™¨ IPï¼š** 192.168.1.10

**åç«¯é…ç½® (`192.168.1.20`)ï¼š**
```json
{
  "settings": {
    "serverHost": "192.168.1.20"
  }
}
```

**æˆ–ï¿½ï¿½ç”¨ç¯å¢ƒå˜é‡ï¼š**
```bash
SERVER_HOST=192.168.1.20 npm run start
```

**è®¿é—®åœ°å€ï¼š**
- å‰ç«¯ç•Œé¢ï¼šhttp://192.168.1.10:5173
- åç«¯ APIï¼šhttp://192.168.1.20:3000
- éƒ¨ç½²çš„é¡¹ç›®ï¼šhttp://192.168.1.20:3001, 3002, ...

**å‰ç«¯ä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š**

å¦‚æœå¸Œæœ›é€šè¿‡å‰ç«¯åŸŸåè®¿é—®é¡¹ç›®ï¼Œéœ€è¦é…ç½® Nginx åå‘ä»£ç†ï¼š

```nginx
# åœ¨å‰ç«¯æœåŠ¡å™¨ (192.168.1.10) ä¸Šé…ç½®
server {
    listen 80;
    server_name frontend.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        proxy_pass http://127.0.0.1:5173;
    }

    # åç«¯ API
    location /api/ {
        proxy_pass http://192.168.1.20:3000;
    }

    # ä»£ç†éƒ¨ç½²çš„é¡¹ç›®
    location /projects/ {
        rewrite ^/projects/(.*)$ /$1 break;
        proxy_pass http://192.168.1.20:3001;
    }
}
```

### åœºæ™¯ 4ï¼šå…¬ç½‘éƒ¨ç½²ï¼ˆä½¿ç”¨åŸŸåï¼‰

**é…ç½®ï¼š**
```json
{
  "settings": {
    "serverHost": "api.yourdomain.com"
  }
}
```

**æˆ–ç¯å¢ƒå˜é‡ï¼š**
```bash
SERVER_HOST=api.yourdomain.com npm run start
```

**è®¿é—®åœ°å€ï¼š**
- éƒ¨ç½²çš„é¡¹ç›®ï¼šhttp://api.yourdomain.com:3001

**æ³¨æ„ï¼š**
- éœ€è¦é…ç½®é˜²ç«å¢™å¼€æ”¾ç«¯å£ 3001-3050
- å»ºè®®ä½¿ç”¨ Nginx åå‘ä»£ç†ç»Ÿä¸€ç«¯å£

### åœºæ™¯ 5ï¼šä½¿ç”¨ Nginx åå‘ä»£ç†

**åç«¯é…ç½®ï¼š**
```json
{
  "settings": {
    "serverHost": "projects.yourdomain.com"
  }
}
```

**Nginx é…ç½®ï¼š**
```nginx
server {
    listen 80;
    server_name projects.yourdomain.com;

    # é¡¹ç›® A
    location /project-a/ {
        proxy_pass http://127.0.0.1:3001/;
        proxy_set_header Host $host;
    }

    # é¡¹ç›® B
    location /project-b/ {
        proxy_pass http://127.0.0.1:3002/;
        proxy_set_header Host $host;
    }
}
```

**è®¿é—®åœ°å€ï¼š**
- é¡¹ç›® Aï¼šhttp://projects.yourdomain.com/project-a/
- é¡¹ç›® Bï¼šhttp://projects.yourdomain.com/project-b/

## ğŸ” åœ°å€ä¼˜å…ˆçº§

ç³»ç»ŸæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾æœåŠ¡å™¨åœ°å€ï¼š

```
1. ç¯å¢ƒå˜é‡ SERVER_HOST
   â†“ (æœªè®¾ç½®)
2. é…ç½®æ–‡ä»¶ settings.serverHost
   â†“ (æœªè®¾ç½®)
3. è‡ªåŠ¨æ£€æµ‹å±€åŸŸç½‘ IP
   â†“ (æœªæ‰¾åˆ°)
4. localhost
```

## ğŸ“ é…ç½®ç¤ºä¾‹

### å¼€å‘ç¯å¢ƒ

```json
{
  "settings": {
    "serverHost": "localhost"
  }
}
```

### æµ‹è¯•ç¯å¢ƒï¼ˆå±€åŸŸç½‘ï¼‰

```json
{
  "settings": {
    "serverHost": "192.168.1.100"
  }
}
```

### ç”Ÿäº§ç¯å¢ƒ

**æ–¹å¼ 1ï¼šä½¿ç”¨åŸŸå**
```json
{
  "settings": {
    "serverHost": "app.example.com"
  }
}
```

**æ–¹å¼ 2ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡**
```bash
# .env æ–‡ä»¶
SERVER_HOST=app.example.com
PORT=3000
```

```javascript
// åœ¨å¯åŠ¨è„šæœ¬ä¸­åŠ è½½
import dotenv from 'dotenv'
dotenv.config()
```

## ğŸ§ª éªŒè¯é…ç½®

### 1. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—

å¯åŠ¨åç«¯æ—¶ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š
```
[getServerHost] Using SERVER_HOST from env: api.example.com
# æˆ–
[getServerHost] Using serverHost from config: 192.168.1.20
# æˆ–
[getServerHost] Auto-detected IP: 192.168.1.100
```

### 2. éƒ¨ç½²é¡¹ç›®åæŸ¥çœ‹ URL

éƒ¨ç½²å®Œæˆåï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š
```
[startServerV3] Project accessible at: http://192.168.1.20:3001
```

### 3. å‰ç«¯æŸ¥çœ‹è®¿é—®ç«™ç‚¹æŒ‰é’®

ç‚¹å‡»"è®¿é—®ç«™ç‚¹"æŒ‰é’®ï¼Œæ£€æŸ¥è·³è½¬çš„ URL æ˜¯å¦æ­£ç¡®ã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. é˜²ç«å¢™é…ç½®

ç¡®ä¿åç«¯æœåŠ¡å™¨çš„ç«¯å£å·²å¼€æ”¾ï¼š
```bash
# Linux (ufw)
sudo ufw allow 3000:3050/tcp

# Linux (firewalld)
sudo firewall-cmd --add-port=3000-3050/tcp --permanent
sudo firewall-cmd --reload
```

### 2. ç«¯å£å†²çª

- å‰ç«¯ï¼š5173
- åç«¯ APIï¼š3000
- éƒ¨ç½²çš„é¡¹ç›®ï¼š3001-3050ï¼ˆå¯é…ç½®ï¼‰

ç¡®ä¿è¿™äº›ç«¯å£æ²¡æœ‰è¢«å…¶ä»–ç¨‹åºå ç”¨ã€‚

### 3. è·¨åŸŸé—®é¢˜

å¦‚æœå‰åç«¯åˆ†ç¦»ï¼Œéœ€è¦é…ç½® CORSï¼š

```javascript
// server/index.js
app.use(cors({
  origin: ['http://192.168.1.10:5173', 'http://frontend.com'],
  credentials: true
}))
```

### 4. HTTPS

ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ HTTPSï¼š
```nginx
server {
    listen 443 ssl;
    server_name app.example.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    # ... proxy é…ç½®
}
```

## ğŸ¯ æ¨èé…ç½®

### å°å›¢é˜Ÿæœ¬åœ°å¼€å‘
```json
{
  "settings": {
    "serverHost": "192.168.1.100"  // å±€åŸŸç½‘ IP
  }
}
```

### äº‘æœåŠ¡å™¨éƒ¨ç½²
```bash
# ä½¿ç”¨ç¯å¢ƒå˜é‡
SERVER_HOST=your-server-ip npm run start
```

### ä½¿ç”¨åŸŸå
```bash
# é…ç½® Nginx åå‘ä»£ç†
SERVER_HOST=your-domain.com npm run start
```

## ğŸ“š æ€»ç»“

- âœ… **é¡¹ç›®è¿è¡Œåœ¨åç«¯æœåŠ¡å™¨**ä¸Šï¼Œä¸æ˜¯å‰ç«¯
- âœ… **æ”¯æŒ 3 ç§é…ç½®æ–¹å¼**ï¼šç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ã€è‡ªåŠ¨æ£€æµ‹
- âœ… **çµæ´»éƒ¨ç½²**ï¼šæ”¯æŒæœ¬æœºã€å±€åŸŸç½‘ã€å…¬ç½‘ç­‰å¤šç§åœºæ™¯
- âœ… **æ˜“äºæ‰©å±•**ï¼šå¯é…åˆ Nginx å®ç°æ›´å¤æ‚çš„éƒ¨ç½²æ¶æ„

---

**æ›´æ–°æ—¥æœŸï¼š** 2025-11-12  
**ç‰ˆæœ¬ï¼š** 1.0

